@if (!loading) {

    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb m-3">
            <li class="breadcrumb-item"><a [routerLink]="['/home']" routerLinkActive="router-link-active" >Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{tourData.name}}</li>
        </ol>
    </nav>
    <ng-container>
    <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-end gap-2" style="height: 40px;">
            <i class="bi bi-cup-hot" style="cursor: pointer;" (click)="open(content)"></i>
            <i *ngIf="!tableView" class="bi bi bi-distribute-horizontal" style="cursor: pointer;" (click)="tableView ? tableView = false : tableView = true"></i>
            <i *ngIf="tableView" class="bi bi-distribute-vertical" style="cursor: pointer;" (click)="tableView ? tableView = false : tableView = true"></i>
            <i class="bi bi-gear" style="cursor: pointer;" (click)="isCollapsed = !isCollapsed"></i>
            <i class="bi bi-car-front-fill" style="cursor: pointer;" (click)="isCollapsed = !isCollapsed"></i>
        </div>
        <div class="card-body p-3" style="height: 100px;">
            <h2 style="cursor: pointer;">{{tourData.name}} </h2> 
            <h5>{{tourData.start }} bis {{tourData.end }}</h5>
        </div>
    </div>
    
    <!-- TOUR DETAILS -->
    <div class="row">
        <div #collapse="ngbCollapse" [(ngbCollapse)]="isCollapsed">
            <div class="card mt-2">
                <div class="card-body">
                    <h4>Tour Details</h4>
                    <form [formGroup]="tourForm">
                        <div class="row">
                            <div class="col-12">
                                <table class="table">
                                    <tbody>
                                        <!-- START -->
                                        <tr>
                                            <th scope="row">Anreise:</th>
                                            <td>
                                                <div class="row">
                                                    <div class="col-3">
                                                        {{tourData.start}}
                                                    </div>
                                                    <!-- <div class="col-6">
                                                        <div class="form-check">
                                                            <input formControlName="arrivalChecked" class="form-check-input" type="checkbox" value="" id="flexCheckChecked">
                                                            <label class="form-check-label" for="flexCheckChecked">
                                                                Anreise morgends
                                                            </label>
                                                        </div>
                                                    </div> -->
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- END -->
                                        <tr>
                                            <th scope="row">Abreise:</th>
                                            <td>
                                                <div class="row">
                                                    <div class="col-3">
                                                        {{tourData.end}}
                                                    </div>
                                                    <!-- <div class="col-6">
                                                        <div class="form-check">
                                                            <input formControlName="departureChecked" class="form-check-input" type="checkbox" value="" id="flexCheckChecked">
                                                            <label class="form-check-label" for="flexCheckChecked">
                                                                Abreise morgends
                                                            </label>
                                                        </div>
                                                    </div> -->
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- PARTICIPANTS    -->
                                        <tr>
                                            <th scope="row">Teilnehmer:</th>
                                            <td>
                                                <div class="row">
                                                    <div class="col-3">
                                                        {{tourParticipants.length}}
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- THINGS -->
                                        <tr>
                                            <th scope="row">Mitbringsel:</th>
                                            <td>
                                                <div class="row">
                                                    <div class="col-3">
                                                        {{tourThings.length}}
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- PARTICIPANTS -->
        <div [ngClass]="tableView ? 'col' : ''">
            <div class="card mt-2 shadow-sm">
                <div class="card-header d-flex justify-content-between">
                    <h4 class="p-3">Teilnehmer</h4>
                    <div>
                        <!-- SELECT BOX -->
                        <select class="form-select form-select-sm" aria-label="Small select example" (change)="addTourParticipant($event)">
                            <option selected>Teilnehmer hinzufügen</option>
                            @for (participant of participants; track participant.name) {
                                    <option [value]="participant.id">{{ participant.name }}</option>
                                } @empty {
                                    <li>There are no items.</li>
                                }
                        </select>
                    </div>
                    <!-- ADD PARTICIPANT -->
                    <app-add-participant (reloadData)="getParticipants()"></app-add-participant>
                </div>
                
                <div class="card-body mx-2 mb-2">
                    @for (participant of tourParticipants; track participant.id; let  i = $index) {
                        <div ngbAccordion>
                            <div ngbAccordionItem [collapsed]="true">
                                <h2 ngbAccordionHeader>
                                    <button ngbAccordionButton>
                                        <img class="rounded me-2" style="height: 20px; width: auto;" src="assets\images\avatars\{{participantsMap[participant.id].avatar}}.jpg">
                                        {{participantsMap[participant.id].name}}
                                        <!-- SHOW BURDEN COUNT -->
                                    </button>
                                </h2>
                                <div ngbAccordionCollapse>
                                    <div ngbAccordionBody>
                                        <ng-template>
                                            <ol class="list-group list-group-numbered">
                                                @for (burden of tourThings; track burden;) {
                                                    @if(burden.carrier == participant.id){
                                                        <li class="list-group-item d-flex justify-content-between align-items-start">
                                                            <div class="ms-2 me-auto">
                                                                <div class="fw-bold">{{thingsMap[burden.id].name}}</div>
                                                            </div>
                                                            <!-- <span class="badge text-bg-primary rounded-pill">14</span> -->
                                                        </li>
                                                    }
                                                } @empty {
                                                    Bisher nichts zugeordnet
                                                }
                                            </ol>
                                        </ng-template>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    } @empty {
                        <button type="button" class="list-group-item list-group-item-action"> Bisher keine Teilnehmer </button>
                    }
                </div>
            </div>
            
        </div>
        <!-- THINGS -->
        <div [ngClass]="tableView ? 'col' : ''">
            <div class="card mt-2 shadow-sm">
                <div class="card-header d-flex justify-content-between">
                    <h4 class="p-3">Gepäck</h4>
                    <div>
                        <select class="form-select form-select-sm" aria-label="Small select example" (change)="addTourThing($event)">
                            <option selected>Gepäck hinzufügen</option>
                            @for (thing of things; track thing.name) {
                                    <option [value]="thing.id">{{ thing.name }}</option>
                                } @empty {
                                    <li>There are no items.</li>
                                }
                        </select>
                    </div>
                    <app-add-thing (reloadData)="getThings();">
                    </app-add-thing>
                </div>
                <div class="card-body mx-2">
                    <table class="table">
                        <tbody class="border">
                            @for (thing of tourThings; track thing; let i = $index;) {
                            <tr>
                                <td class="align-middle" style="height: 54px">
                                    <div class="row">
                                        <div class="col-6 ">
                                            {{thingsMap[thing.id].name}}
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select form-select-sm" aria-label="Default select example" (change)="assignThingTo(thing.id, $event)">
                                                <option [value]="''">Nicht zugewiesen</option>
                                                @for (participant of participants; track participant){
                                                    <option [value]="participant.id" [selected]="participant.id == thing.carrier">{{participant.name}}</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- CARSHARING -->
        <div [ngClass]="tableView ? 'col' : ''">
            <app-carsharing></app-carsharing>
        </div>
    </div>
    <div>
        <button type="button" class="btn btn-primary m-3" (click)="editTour()">Speichern</button>
    </div>
    </ng-container>
}

<!-- OFFCANVAS MEALS -->
<ng-template #content let-offcanvas>
	<div class="offcanvas-header">
		<h4 class="offcanvas-title" id="offcanvas-basic-title">Mahzeilten Übersicht</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="offcanvas.dismiss('Cross click')"></button>
	</div>
    @for (meal of meals; track meal; let i = $index;) {
        <!-- <div class="offcanvas-body">
            
                
            
            
            <div class="text-end">
                <button type="button" class="btn btn-outline-dark" (click)="offcanvas.close('Save click')">Save</button>
            </div>
        </div> -->
        <div class="m-2">
            <div 
            class="card" 
            style="height: 35px;"
            >
            <div>
                <span style="cursor: pointer;" (click)="isCollapsed = !isCollapsed">{{meal.type}}</span>
            </div>
        </div>
        <div>
            <select class="form-select" aria-label="Default select example">
                <option>Nicht zugewiesen</option>
                @for (participant of participants; track participant){
                    <option>{{participant}}</option>
                }
            </select>
        </div>
        </div>
        
    }

	
</ng-template>








